!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.kaop={})}(this,function(e){"use strict";function t(e){return!e.advice}var r={isMethod:t,isValidArraySignature:function(e){return e.every(function(e){return"function"==typeof e})&&1===e.filter(t).length},getMethodFromArraySignature:function(e){return e.find(t)},isAsync:function(e){return!!e.toString().match(/[a-zA-Z$_]\.commit/)},createInstance:function(e,t){return t.unshift(null),new(Function.prototype.bind.apply(e,t))}};function n(e,t,n){return function(){var i=-1;function o(){if(n[++i]){var e=n[i];if(r.isMethod(e)){if(!c.prevented)try{c.result=e.apply(c.scope,c.args)}catch(e){c.exception=e}}else e.call(void 0,c);r.isAsync(e)||c.commit()}else if(c.exception)throw c.exception}var c={args:Array.prototype.slice.call(arguments),scope:this,key:t,method:r.getMethodFromArraySignature(n),target:e,exception:void 0,prevented:void 0,result:void 0,commit:o,prevent:function(){c.prevented=!0},handle:function(){var e=c.exception;return delete c.exception,e},skip:function(){i=n.findIndex(r.isMethod)-1}};return o(),c.result}}var i={advice:function(e){return e.advice=1,e},aspect:function(e){return function(t){return Object.keys(t).reduce(e,t)}},wove:function(e,t){var i=Object.assign({},t);for(var o in i)i[o]instanceof Array&&r.isValidArraySignature(i[o])&&(i[o]=n(e,o,i[o]));return i},createProxyFn:n};function o(e,t,r){function n(){"function"==typeof this.constructor&&this.constructor.apply(this,arguments)}n.super=e,n.signature=t;var o=i.wove(n,t);return n.prototype=Object.assign(Object.create(e.prototype),o),n}var c={createClass:function(e){return o(function(){},e)},extend:function(e,t){return o(e,t)},clear:function(e){for(var t in e.signature)e.signature[t]instanceof Array&&r.isValidArraySignature(e.signature[t])&&(e.prototype[t]=r.getMethodFromArraySignature(e.signature[t]));return e}},a=i.advice(function(e){e.target.super.prototype[e.key].apply(e.scope,e.args)}),u=i.advice(function(e){e.args.unshift(e.target.super.prototype[e.key].bind(e.scope))});var s={createClass:c.createClass,extend:c.extend,clear:c.clear,override:{apply:a,implement:u},inject:{args:function(){var e=Array.prototype.slice.call(arguments);return i.advice(function(t){if("constructor"!==t.key)throw new Error("inject only available in constructor");e.forEach(function(e){t.args.push(e())})})},assign:function(e){return i.advice(function(t){for(var r in e){var n=e[r];t.scope[r]=n()}})}},provider:{factory:function(e){return function(){return r.createInstance(e,Array.prototype.slice.call(arguments))}},singleton:function(e){var t;return function(){var n=Array.prototype.slice.call(arguments);return t||(t=r.createInstance(e,n)),t}}},reflect:i},f=s.createClass,p=s.extend,l=s.clear,d=s.override,y=s.inject,v=s.provider,g=s.reflect;e.default=s,e.createClass=f,e.extend=p,e.clear=l,e.override=d,e.inject=y,e.provider=v,e.reflect=g,Object.defineProperty(e,"__esModule",{value:!0})});
